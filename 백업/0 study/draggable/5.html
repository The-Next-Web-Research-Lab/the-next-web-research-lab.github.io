<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    .wrapper {
      overflow: hidden;
    }
    .drop-box {
      width: 350px;
      height: 310px;
      padding: 10px;
      border: 1px solid #aaaaaa;
      background: #fff;
      float: left;
    }
    .drag-box {
      width: 350px;
      height: 70px;
      background: #ccc;
      border: 1px solid #000;
    }
  </style>
</head>
<body>

<div class="wrapper">
  <div class="drop-box">
    <h1>Header1</h1>
    <div class="drag-box" draggable="true">1</div>
    <div class="drag-box" draggable="true">2</div>
    <div class="drag-box" draggable="true">3</div>
  </div>
  <div class="drop-box" draggable="true">
    <h1>Header2</h1>
  </div>
  <div class="drop-box" draggable="true">
    <h1>Header3</h1>
  </div>
  <div class="drop-box" draggable="true">
    <h1>Header4</h1>
  </div>
</div>

<script>
  const replacePosition = (targetElement, element) => {
    const {parentNode} = targetElement;
    const childList = [...parentNode.childNodes];
    const targetIndex = childList.findIndex(child => child === targetElement);
    const elementIndex = childList.findIndex(child => child === element);
    const position = targetIndex < elementIndex
      ? 'beforebegin'
      : 'afterend';

    targetElement.insertAdjacentElement(position, element);
  };

  const sortable = ({selector, drag = () => {}}) => {
    const dragBoxAll = document.querySelectorAll(selector);

    let draggingBox = null;

    const changeDraggingBox = newDraggingBox => {
      draggingBox = newDraggingBox;
      drag(draggingBox)
    };

    const onDragStart = event => {
      event.stopPropagation();
      changeDraggingBox(event.target)
    };

    const onDragEnd = () => {
      changeDraggingBox(null)
    };

    const onDragOver = event => {
      event.preventDefault();
      event.stopPropagation();

      if ([...dragBoxAll].includes(event.target) && draggingBox) {
        replacePosition(event.target, draggingBox);
      }
    };

    dragBoxAll.forEach(dragBox => {
      dragBox.addEventListener('dragstart', onDragStart);
      dragBox.addEventListener('dragend', onDragEnd);
      dragBox.addEventListener('dragover', onDragOver);
    });
  };

  const droppable = ({selector, dropItem = () => {}}) => {
    const dropBoxAll = document.querySelectorAll(selector);

    const onDragOver = event => {
      event.preventDefault();

      if ([...dropBoxAll].includes(event.target)) {
        const item = dropItem();
        item && event.target.appendChild(item);
      }
    };

    dropBoxAll.forEach(dropBox => {
      dropBox.addEventListener('dragover', onDragOver)
    });
  };

  let draggingBox = null;

  droppable({
    selector: '.drop-box',
    dropItem: () => draggingBox
  });

  sortable({
    selector: '.drag-box',
    drag: element => {
      draggingBox = element;
    }
  });

  sortable({
    selector: '.drop-box[draggable="true"]'
  });
</script>
</body>
</html>
