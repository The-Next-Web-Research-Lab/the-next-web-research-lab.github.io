import{_ as o,r as a,o as c,c as l,a as n,b as s,d as t,w as i,e as u}from"./app-06ea889c.js";const r={},k=n("h1",{id:"immer-구현해보기-불변성편",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#immer-구현해보기-불변성편","aria-hidden":"true"},"#"),s(" immer 구현해보기 - 불변성편")],-1),d=n("blockquote",null,[n("p",null,"2019년 12월 2일에 작성한 포스트입니다.")],-1),m=n("h3",{id:"글의-목적",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#글의-목적","aria-hidden":"true"},"#"),s(" 글의 목적")],-1),v={href:"https://immerjs.github.io/immer/docs/produce",target:"_blank",rel:"noopener noreferrer"},b=u(`<p>하지만 영속적 자료 구조가 필요하지 않고 불변성만 필요할 때는 간단하게 구현 가능하다. produce를 처음 접했을 때 영속적 자료 구조에 대한 이점은 불필요하여 만들었던 함수에 대한 내용이다.</p><h3 id="간단한-produce-함수-구현" tabindex="-1"><a class="header-anchor" href="#간단한-produce-함수-구현" aria-hidden="true">#</a> 간단한 produce 함수 구현</h3><p>produce는 이런 형태로 구현가능하다. 상태를 clone하고 명령 함수를 통해 상태를 변경하는 것이다.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">clone</span> <span class="token operator">=</span> <span class="token parameter">json</span> <span class="token operator">=&gt;</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">produce</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> recipe</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> clonedState <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>
  <span class="token function">recipe</span><span class="token punctuation">(</span>clonedState<span class="token punctuation">)</span>
  <span class="token keyword">return</span> clonedState
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>테스트해보면 이런 결과가 나온다. immer를 사용했을 때와 다른 점은 <code>nextState[0] === baseState[0]</code>이 부분이다. 변경하지 않는 부분도 새로 만든 점이 다르다.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> baseState <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">todo</span><span class="token operator">:</span> <span class="token string">&quot;Learn typescript&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">todo</span><span class="token operator">:</span> <span class="token string">&quot;Try immer&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> nextState <span class="token operator">=</span> <span class="token function">produce</span><span class="token punctuation">(</span>baseState<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">draftState</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  draftState<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">todo</span><span class="token operator">:</span> <span class="token string">&quot;Tweet about it&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  draftState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>done <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baseState<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baseState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>done <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>done <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// true</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> baseState<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> baseState<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="끝" tabindex="-1"><a class="header-anchor" href="#끝" aria-hidden="true">#</a> 끝</h3><p>해당 함수를 구현해서 서비스에 사용중이다. 만약에 영속적 자료 구조의 이점이 필요없고, 단순히 immer의 인터페이스때문에 사용중이라면 해당 기능으로 대체 가능하다.</p>`,8);function h(f,_){const e=a("ExternalLinkIcon"),p=a("RouterLink");return c(),l("div",null,[k,d,m,n("p",null,[s("먼저 immer의 "),n("a",v,[s("produce"),t(e)]),s("에 대한 설명을 하면, produce는 영속적 자료 구조(Persistent Data Structure)이다. 변경이 필요한 부분만 새로 상태를 만들고 변경이 필요하지 않는 부분은 기존 상태를 유지한다.")]),b,n("p",null,[s("clone 함수는 JSON에서 지원하는 타입만 사용가능하다. 다양한 타입이나 좀더 좋은 성능의 clone함수는 "),t(p,{to:"/essay/clone-function.html"},{default:i(()=>[s("경우에 따른 clone 함수")]),_:1}),s("에서 다룬다.")])])}const S=o(r,[["render",h],["__file","produce-immutable.html.vue"]]);export{S as default};
