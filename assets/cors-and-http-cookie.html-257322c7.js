import{_ as e}from"./plugin-vue_export-helper-c27b6911.js";import{o as n,c as s,e as t}from"./app-e303a558.js";const a={},o=t(`<h1 id="cors-and-http-cookie" tabindex="-1"><a class="header-anchor" href="#cors-and-http-cookie" aria-hidden="true">#</a> CORS and HTTP Cookie</h1><blockquote><p>This is a post I wrote on October 22, 2019 to explain to a BE developer who I was collaborating with while developing an internal service.</p></blockquote><h3 id="purpose-of-the-article" tabindex="-1"><a class="header-anchor" href="#purpose-of-the-article" aria-hidden="true">#</a> Purpose of the article</h3><p>Cross-Origin Resource Sharing! It is called CORS by taking the first letters. In my experience, CORS is the first phenomenon that occurs when a client and an API server using different domains communicate.</p><p>Recently, I had to use HTTP Cookie, and I learned new knowledge about CORS while using Cookie. So I summarized the contents of how to handle CORS and HTTP Cookie.</p><h3 id="what-is-cors" tabindex="-1"><a class="header-anchor" href="#what-is-cors" aria-hidden="true">#</a> What is CORS</h3><p>CORS is a security mechanism that occurs when a client using a different domain requests a server. When a client requests a server of a different domain, it requests by <strong>Cross-Origin HTTP request</strong>. HTTP requests and responses according to <strong>Cross-Origin HTTP request</strong> must be composed of CORS mechanism.</p><p>The server sets the allow/deny status when a request from a client using a different domain comes. The setting for allow/deny is done through <strong>Access-Control-Allow-Origin</strong> in the HTTP Header.</p><p><strong>Access-Control-Allow-Origin</strong> specifies the domain to allow or writes a wildcard (*) that can allow all domains.</p><h4 id="example-the-phenomenon-before-using-access-control-allow-origin" tabindex="-1"><a class="header-anchor" href="#example-the-phenomenon-before-using-access-control-allow-origin" aria-hidden="true">#</a> [Example] The phenomenon before using Access-Control-Allow-Origin</h4><blockquote><p>Client (http://localhost:3000), Server (http://localhost:4000)</p></blockquote><p>If <strong>Access-Control-Allow-Origin</strong> is not set in the server response header, an error occurs for the policy.</p><h5 id="http-request" tabindex="-1"><a class="header-anchor" href="#http-request" aria-hidden="true">#</a> HTTP request</h5><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:4000&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="chrome-developer-tool-console" tabindex="-1"><a class="header-anchor" href="#chrome-developer-tool-console" aria-hidden="true">#</a> Chrome developer tool &gt; Console</h5><p>Access to fetch at &#39;http://localhost:4000/&#39; from origin &#39;http://localhost:3000&#39; has been blocked by CORS policy: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource. If an opaque response serves your needs, set the request&#39;s mode to &#39;no-cors&#39; to fetch the resource with CORS disabled.</p><h4 id="example-the-phenomenon-after-using-access-control-allow-origin" tabindex="-1"><a class="header-anchor" href="#example-the-phenomenon-after-using-access-control-allow-origin" aria-hidden="true">#</a> [Example] The phenomenon after using Access-Control-Allow-Origin</h4><p>It works normally when <strong>Access-Control-Allow-Origin</strong> is set in the server response header.</p><h5 id="http-request-1" tabindex="-1"><a class="header-anchor" href="#http-request-1" aria-hidden="true">#</a> HTTP request</h5><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:4000&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="chrome-developer-tool-network-response-headers" tabindex="-1"><a class="header-anchor" href="#chrome-developer-tool-network-response-headers" aria-hidden="true">#</a> Chrome developer tool &gt; Network &gt; Response Headers</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Access-Control-Allow-Origin: *
Content-Length: 12
Content-Type: text/html; charset=utf-8
Date: Mon, 21 Oct 2019 21:56:47 GMT
ETag: W/&quot;c-Lve95gjOVATpfV8EL5X4nxwjKHE&quot;
X-Powered-By: Express
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="credentials-setting-for-using-http-cookie" tabindex="-1"><a class="header-anchor" href="#credentials-setting-for-using-http-cookie" aria-hidden="true">#</a> Credentials setting for using HTTP Cookie</h3><h4 id="the-situation-where-http-cookie-was-used" tabindex="-1"><a class="header-anchor" href="#the-situation-where-http-cookie-was-used" aria-hidden="true">#</a> The situation where HTTP Cookie was used</h4><p>First of all, the reason why I used HTTP Cookie was to determine the login and login status. The service configuration consists of three: client service, API server, and login service, each using a different domain.</p><p>After logging in at the login service, the login completion status is stored in the Cookie and redirected to the client service. Cookie is set to HttpOnly so that it cannot be accessed by the client service.</p><blockquote><p>If Cookie is set to HttpOnly, it cannot be accessed by Javascript&#39;s <code>document.cookie</code>.</p></blockquote><p>In the client service, it requests the API server to <strong>determine the login status</strong>. At this time, <strong>client and server Credentials</strong> settings are required to use Cookie on the API server.</p><h4 id="credentials-setting" tabindex="-1"><a class="header-anchor" href="#credentials-setting" aria-hidden="true">#</a> Credentials setting</h4><p>Both the client and the server must activate Credentials.</p><h5 id="client-credentials-setting" tabindex="-1"><a class="header-anchor" href="#client-credentials-setting" aria-hidden="true">#</a> Client Credentials setting</h5><p>The client can set it differently depending on the Javascript API. The following are examples of the most commonly used fetch and XMLHttpRequest.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:4000&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">credentials</span><span class="token operator">:</span> <span class="token string">&#39;include&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">&#39;http://localhost:4000&#39;</span><span class="token punctuation">;</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="server-credentials-setting" tabindex="-1"><a class="header-anchor" href="#server-credentials-setting" aria-hidden="true">#</a> Server Credentials setting</h5><p>The server sets Credentials in the response header. Set the header named <strong>Access-Control-Allow-Credentials</strong> to true.</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>After activating <strong>Credentials</strong>, the following error occurs when making an HTTP request.</p><p>Access to fetch at &#39;http://localhost:4000/&#39; from origin &#39;http://localhost:3000&#39; has been blocked by CORS policy: The value of the &#39;Access-Control-Allow-Origin&#39; header in the response must not be the wildcard &#39;*&#39; when the request&#39;s credentials mode is &#39;include&#39;.</p><p>This is because you cannot use a wildcard (*) in <strong>Access-Control-Allow-Origin</strong> after activating <strong>Credentials</strong>.</p><p>The point to note here is that the situation of the client and the server is different by activating Credentials. On the server, activating Credentials allows access to Cookie, so it looks like normal operation. However, on the client, HTTP response cannot be checked due to CORS policy.</p><h4 id="credentials-and-access-control-allow-origin-setting" tabindex="-1"><a class="header-anchor" href="#credentials-and-access-control-allow-origin-setting" aria-hidden="true">#</a> Credentials and Access-Control-Allow-Origin setting</h4><p>In the server HTTP response header, write the domain of the client to allow in <strong>Access-Control-Allow-Origin</strong>. After setting, you can check the normal operation by checking the client response header.</p><h5 id="server-http-response-header-setting" tabindex="-1"><a class="header-anchor" href="#server-http-response-header-setting" aria-hidden="true">#</a> Server HTTP response header setting</h5><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Origin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
res<span class="token punctuation">.</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">&quot;Access-Control-Allow-Credentials&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="chrome-developer-tool-network-response-headers-1" tabindex="-1"><a class="header-anchor" href="#chrome-developer-tool-network-response-headers-1" aria-hidden="true">#</a> Chrome developer tool &gt; Network &gt; Response Headers</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>Access-Control-Allow-Credentials: true
Access-Control-Allow-Origin: http://localhost:3000
Content-Length: 12
Content-Type: text/html; charset=utf-8
Date: Mon, 21 Oct 2019 22:46:47 GMT
ETag: W/&quot;c-Lve95gjOVATpfV8EL5X4nxwjKHE&quot;
X-Powered-By: Express
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="conclusion" tabindex="-1"><a class="header-anchor" href="#conclusion" aria-hidden="true">#</a> Conclusion</h3><p>Using different domains for the client and the API server is a common pattern in the field. This pattern occurs once or twice during the initial development of the service. It can be solved by simply following the CORS policy. The issue of CORS is not something that only one side of the client and server managers should be aware of, but everyone needs to understand. I think it is better to solve this issue smoothly by following the CORS policy and focus on business development.</p>`,49),i=[o];function r(c,l){return n(),s("div",null,i)}const h=e(a,[["render",r],["__file","cors-and-http-cookie.html.vue"]]);export{h as default};
